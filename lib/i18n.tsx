"use client"

import React, { createContext, useContext, useEffect, useMemo, useState } from "react"

type Locale = "en" | "zh"

type Dict = Record<string, string>

const dicts: Record<Locale, Dict> = {
  en: {
    setDetails: "Set Details",
    translations: "Translations",
    coverImage: "Cover Image",
    properties: "Properties",
    categories: "Categories",
    seasons: "Seasons",
    sections: "Sections",
    primaryLocation: "Primary Location",
    tags: "Tags",
    options: "Options",
    preview: "Preview",
    title: "Title",
    subtitle: "Subtitle",
    description: "Description",
    aiToolsCover: "AI Tools (Cover)",
    aiToolsPicture: "AI Tools (Picture)",
    published: "Published",
    autoTranslateSet: "Auto-fill locales (set + pictures)",
    autoTranslatePicture: "Auto-fill locales for this picture",
    autoTranslateSetOnly: "Auto-fill locales for set only",
    clickToUploadCover: "Click to upload cover image",
    supportsFormats: "Supports JPG, PNG, WebP",
    noImagesYet: "No images yet",
    addImage: "Add Image",
    addImagesBulk: "Add Images (Bulk)",
    reorderPictures: "Reorder pictures",
    dragToReorder: "Drag thumbnails to reorder",
    geocode: "Geocode",
    typesCategories: "Types (categories)",
    pictureStyle: "Photography Style",
    selectPictureStyle: "Select style",
    styleNone: "No specific style",
    pictureStyleHint: "Styles drive the homepage showcase (Landscape, Portrait, Street, Travel).",
    styleLandscape: "Landscape",
    stylePortrait: "Portrait",
    styleStreet: "Street",
    styleTravel: "Travel",
    styleShowcaseTitle: "Photography Styles",
    styleShowcaseSubtitle: "Hover to explore four signature looks and open any panel to dive into its full collection.",
    styleShowcaseInstruction: "Hover to explore • Click to view carousel",
    styleViewGallery: "View gallery",
    styleEmpty: "Coming soon",
    styleUntitled: "Untitled",
    styleFromSeries: "From series",
    backToHome: "Back to galleries",
    season: "Season",
    location: "Location",
    viewOriginal: "View Original",
    galleriesTitle: "Lijie's Galleries",
    mapSectionTitle: "Latitude of Memories",
    mapSectionSubtitle: "Each glowing orbit marks a place I've photographed—tap to dive into the stories captured there.",
    mapEmptyCallout: "Choose a glowing point to reveal the photographs from that location.",
    mapViewAll: "Explore {{count}} series",
    mapUnknownLocation: "Somewhere on Earth",
    mapUntitledSet: "Untitled collection",
    downGalleryTitle: "Echoes in Frames",
    downGallerySubtitle: "A flowing wall of recent stories—let your eyes wander and step into whichever frame calls out to you.",
    search: "Search",
    openSearch: "Open search",
    close: "Close",
    searching: "Searching…",
    setMatchesHdr: "Set Matches",
    pictureMatchesHdr: "Picture Matches",
    noMatchingSets: "No matching sets",
    noMatchingPictures: "No matching pictures",
    loadingGalleries: "Loading galleries...",
    homeSearchPlaceholder: "Search sets or images (EN/Chinese, multi-word AND)",
    examplesCategoriesHelp: "Examples: Portrait, Landscape, Street, Creative, Documentary, Travel, Architecture, Macro, Night",
    sectionsHelp: "Controls set types and placement (Top/Bottom rows).",
    // Login
    loginTitle: "Login",
    email: "Email",
    password: "Password",
    login: "Log In",
    loggingIn: "Logging in...",
    // Analysis tools (AI)
    aiHeader: "AI Image Analysis",
    generating: "Generating...",
    generateAll: "Generate all fields",
    advancedAnalysisTools: "Advanced analysis tools",
    generatedResults: "Generated results",
    parallelHint: "(Parallel mode, fast & efficient)",
    titleGen: "Title Generation",
    genTitle: "Generate Title",
    genSubtitle: "Generate Subtitle",
    genDescription: "Generate Description",
    subtitleGen: "Subtitle Generation",
    descriptionGen: "Description Generation",
    result: "Result:",
    copy: "Copy",
    copied: "Copied",
    analyzing: "Analyzing...",
    extractTags: "Extract Image Tags",
    tagsResult: "Tags:",
    technicalAnalysis: "Technical Analysis",
    customPrompt: "Custom Prompt:",
    analysisResult: "Analysis Result:",
    runCustom: "Run Custom Analysis",
    // AdminDashboard / List / Toasts / Tabs / Search
    uploadedPictureSets: "Uploaded Picture Sets",
    position: "Position",
    publishedLabel: "Published",
    unpublished: "Unpublished",
    edit: "Edit",
    delete: "Delete",
    areYouSureDeleteSet: "Are you sure you want to delete this picture set?",
    deleteWarning: "This action cannot be undone. This will permanently delete the picture set and all its pictures.",
    cancel: "Cancel",
    deleteAction: "Delete",
    pictures: "pictures",
    noPictures: "No pictures",
    pictureSetsTab: "Picture Sets",
    addNewSetTab: "Add New Picture Set",
    editSetTab: "Edit Picture Set",
    loadingSets: "Loading picture sets...",
    searchPlaceholder: "Search sets: supports EN/Chinese, multi-word AND",
    clear: "Clear",
    adminDashboard: "Admin Dashboard",
    cancelEdit: "Cancel Edit",
    deletePicturesDbFail: "Failed to delete pictures from database",
    // Form headings & labels
    editSet: "Edit Picture Set",
    createSet: "Create New Picture Set",
    englishLabel: "English (en)",
    chineseLabel: "Chinese (zh)",
    clickToChangeImage: "Click to change image",
    originalSize: "Original size:",
    willBeCompressed: "Images above 10MB will be converted to optimized WebP",
    locationNamePlaceholder: "Location name (e.g., The Bund)",
    latitude: "Latitude",
    longitude: "Longitude",
    selectSeason: "Select season",
    noPreview: "No preview",
    images: "images",
    image: "Image",
    picturesHdr: "Pictures",
    clickToAddImagesHint: "Click the button below to add images",
    enterImageTitle: "Enter a title for this image...",
    enterImageSubtitle: "Enter a subtitle for this image...",
    describeImagePlaceholder: "Describe the content and features of this image...",
    tagsPlaceholder: "e.g., portrait, night, bokeh",
    commaSeparated: "comma-separated",
    aiGenerateTitle: "AI generate title",
    aiGenerateSubtitle: "AI generate subtitle",
    aiGenerateDescription: "AI generate description",
    aiGenerateTags: "AI generate tags",
    generateTagsForUntagged: "Generate tags for untagged pictures",
    pleaseAddCoverOrImages: "Please add a cover or images first",
    noImagesYet2: "No images yet",
    saved: "Saved",
    newItem: "New",
    addImageBtn: "Add Image",
    addImagesBulkBtn: "Add Images (Bulk)",
    reorderPicturesHdr: "Reorder pictures",
    dragThumbnails: "Drag thumbnails to reorder",
    submitting: "Submitting...",
    submitSet: "Submit Picture Set",
    updateSet: "Update Picture Set",
    // Toasts
    success: "Success",
    error: "Error",
    createSetSuccess: "Picture set created successfully",
    updateSetSuccess: "Picture set updated successfully",
    deleteSetSuccess: "Picture set deleted successfully",
    loadSetsFail: "Failed to load picture sets",
    createSetFail: "Failed to create picture set",
    updateSetFail: "Failed to update picture set",
    deleteSetFail: "Failed to delete picture set",
    loadSetDataFail: "Failed to load picture set data for editing",
    unexpectedError: "Unexpected error occurred",
    unexpectedDeleteError: "Unexpected error occurred during deletion",
    titleGenFailed: "Title generation failed",
    subtitleGenFailed: "Subtitle generation failed",
    descriptionGenFailed: "Description generation failed",
    oneClickGenFailed: "One-click generation failed, please retry",
    customAnalysis: "Custom Analysis",
    optionsFillMissing: "Fill missing picture fields from this set (season/location)",
    optionsAutogenTitles: "AI-generate title/subtitle for pictures missing them",
    optionsPropagateCategories: "Propagate set categories to all pictures (union)",
  },
  zh: {
    setDetails: "集合详情",
    translations: "翻译",
    coverImage: "封面图片",
    properties: "属性",
    categories: "类别",
    seasons: "季节",
    sections: "版块",
    primaryLocation: "主位置",
    tags: "标签",
    options: "选项",
    preview: "预览",
    title: "标题",
    subtitle: "副标题",
    description: "描述",
    aiToolsCover: "AI 工具（封面）",
    aiToolsPicture: "AI 工具（图片）",
    published: "发布",
    autoTranslateSet: "集合与图片自动补齐语种",
    autoTranslatePicture: "为该图片自动补齐语种",
    autoTranslateSetOnly: "仅补齐集合的语种",
    clickToUploadCover: "点击上传封面",
    supportsFormats: "支持 JPG、PNG、WebP",
    noImagesYet: "还没有图片",
    addImage: "添加图片",
    addImagesBulk: "批量添加图片",
    reorderPictures: "图片排序",
    dragToReorder: "拖动缩略图调整顺序",
    geocode: "地理编码",
    typesCategories: "类型（类别）",
    pictureStyle: "摄影风格",
    selectPictureStyle: "选择风格",
    styleNone: "未设置风格",
    pictureStyleHint: "选择风格后可在首页风格区展示（风光 / 人像 / 街拍 / 旅拍）",
    styleLandscape: "风光",
    stylePortrait: "人像",
    styleStreet: "街拍",
    styleTravel: "旅拍",
    styleShowcaseTitle: "摄影风格专栏",
    styleShowcaseSubtitle: "悬停浏览四种代表性的摄影风格，点击区块即可展开对应照片轮播。",
    styleShowcaseInstruction: "悬停预览 · 点击查看轮播",
    styleViewGallery: "查看图片",
    styleEmpty: "尚未收录",
    styleUntitled: "未命名",
    styleFromSeries: "所属系列",
    backToHome: "返回作品集",
    season: "季节",
    location: "位置",
    viewOriginal: "查看原图",
    galleriesTitle: "Lijie 的作品集",
    mapSectionTitle: "光影坐标",
    mapSectionSubtitle: "每个发光的轨迹都标记着我按下快门的地点，点一下就能展开那里的故事。",
    mapEmptyCallout: "点击地图上的光点，浏览该地点拍摄的作品。",
    mapViewAll: "浏览该地的 {{count}} 组作品",
    mapUnknownLocation: "地球上的某处",
    mapUntitledSet: "未命名作品集",
    downGalleryTitle: "光影回响",
    downGallerySubtitle: "最近的瞬间在此汇聚，随心停留在任何一帧，继续往下探索。",
    search: "搜索",
    openSearch: "打开搜索",
    close: "关闭",
    searching: "搜索中…",
    setMatchesHdr: "集合匹配",
    pictureMatchesHdr: "图片匹配",
    noMatchingSets: "没有匹配的集合",
    noMatchingPictures: "没有匹配的图片",
    loadingGalleries: "正在加载作品集...",
    homeSearchPlaceholder: "搜索集合或图片（支持中英文，多词 AND）",
    examplesCategoriesHelp: "示例：人像、风光、街拍、创意、纪实、旅行、建筑、微距、夜景",
    sectionsHelp: "控制集合类型与展示位置（如：首页上/下排）",
    loginTitle: "登录",
    email: "邮箱",
    password: "密码",
    login: "登录",
    loggingIn: "正在登录...",
    aiHeader: "AI 图片分析",
    generating: "生成中...",
    generateAll: "一键生成所有字段",
    advancedAnalysisTools: "高级分析工具",
    generatedResults: "生成结果",
    parallelHint: "（并行模式，快速高效）",
    titleGen: "标题生成",
    genTitle: "生成标题",
    genSubtitle: "生成副标题",
    genDescription: "生成描述",
    subtitleGen: "副标题生成",
    descriptionGen: "描述生成",
    result: "生成结果：",
    copy: "复制",
    copied: "已复制",
    analyzing: "分析中...",
    extractTags: "提取图片标签",
    tagsResult: "标签结果：",
    technicalAnalysis: "技术分析",
    customPrompt: "自定义分析提示词：",
    analysisResult: "分析结果：",
    runCustom: "运行自定义分析",
    uploadedPictureSets: "已上传的图片集合",
    position: "位置",
    publishedLabel: "已发布",
    unpublished: "未发布",
    edit: "编辑",
    delete: "删除",
    areYouSureDeleteSet: "确定要删除这个图片集合吗？",
    deleteWarning: "该操作不可撤销，将永久删除此集合及其所有图片。",
    cancel: "取消",
    deleteAction: "删除",
    pictures: "张图片",
    noPictures: "暂无图片",
    pictureSetsTab: "图片集合",
    addNewSetTab: "新增图片集合",
    editSetTab: "编辑图片集合",
    loadingSets: "正在加载图片集合...",
    searchPlaceholder: "搜索集合：支持中英文，多词 AND",
    clear: "清除",
    adminDashboard: "管理后台",
    cancelEdit: "取消编辑",
    deletePicturesDbFail: "删除数据库中的图片失败",
    editSet: "编辑图片集合",
    createSet: "新建图片集合",
    englishLabel: "英文 (EN)",
    chineseLabel: "中文 (ZH)",
    clickToChangeImage: "点击更换图片",
    originalSize: "原始大小:",
    willBeCompressed: "大于 10MB 的图片会自动压缩为优化后的 WebP",
    locationNamePlaceholder: "地点名（如：外滩）",
    latitude: "纬度",
    longitude: "经度",
    selectSeason: "选择季节",
    noPreview: "暂无预览",
    images: "张",
    image: "图片",
    picturesHdr: "图片",
    clickToAddImagesHint: "点击下方按钮添加图片",
    enterImageTitle: "为这张图片输入标题...",
    enterImageSubtitle: "为这张图片输入副标题...",
    describeImagePlaceholder: "描述这张图片的内容和特点...",
    tagsPlaceholder: "例如：人像、夜景、虚化",
    commaSeparated: "以逗号分隔",
    aiGenerateTitle: "AI 生成标题",
    aiGenerateSubtitle: "AI 生成副标题",
    aiGenerateDescription: "AI 生成描述",
    aiGenerateTags: "AI 生成标签",
    generateTagsForUntagged: "为未设置标签的图片一键生成标签",
    pleaseAddCoverOrImages: "请先添加封面或图片",
    noImagesYet2: "暂无图片",
    saved: "已保存",
    newItem: "新建",
    addImageBtn: "添加图片",
    addImagesBulkBtn: "批量添加图片",
    reorderPicturesHdr: "图片排序",
    dragThumbnails: "拖动缩略图进行排序",
    submitting: "提交中...",
    submitSet: "提交图片集合",
    updateSet: "更新图片集合",
    success: "成功",
    error: "错误",
    createSetSuccess: "创建图片集合成功",
    updateSetSuccess: "更新图片集合成功",
    deleteSetSuccess: "删除图片集合成功",
    loadSetsFail: "加载图片集合失败",
    createSetFail: "创建图片集合失败",
    updateSetFail: "更新图片集合失败",
    deleteSetFail: "删除图片集合失败",
    loadSetDataFail: "加载编辑数据失败",
    unexpectedError: "发生意外错误",
    unexpectedDeleteError: "删除时发生意外错误",
    titleGenFailed: "标题生成失败",
    subtitleGenFailed: "副标题生成失败",
    descriptionGenFailed: "描述生成失败",
    oneClickGenFailed: "一键生成失败，请重试",
    customAnalysis: "自定义分析",
    optionsFillMissing: "用集合的季节/位置补齐图片缺失字段",
    optionsAutogenTitles: "为缺少标题/副标题的图片使用 AI 生成",
    optionsPropagateCategories: "将集合的类别同步到所有图片（并集）",
  },
}

type I18nCtx = {
  locale: Locale
  setLocale: (l: Locale) => void
  t: (k: string) => string
}

const Ctx = createContext<I18nCtx | null>(null)

export function I18nProvider({ children }: { children: React.ReactNode }) {
  const [locale, setLocaleState] = useState<Locale>("en")
  useEffect(() => {
    const saved = typeof window !== "undefined" ? (localStorage.getItem("locale") as Locale | null) : null
    if (saved === "en" || saved === "zh") setLocaleState(saved)
  }, [])
  const setLocale = (l: Locale) => {
    setLocaleState(l)
    try { localStorage.setItem("locale", l) } catch {}
  }
  const t = useMemo(() => {
    const table = dicts[locale]
    return (k: string) => table[k] ?? k
  }, [locale])
  const value = useMemo(() => ({ locale, setLocale, t }), [locale, setLocale, t])
  return <Ctx.Provider value={value}>{children}</Ctx.Provider>
}

export function useI18n() {
  const ctx = useContext(Ctx)
  if (ctx) return ctx
  // Safe fallback so pages不会白屏，即使未包裹 Provider 也能工作
  const t = (k: string) => (dicts.en[k as keyof typeof dicts.en] as string) ?? k
  const setLocale = (l: 'en' | 'zh') => { try { localStorage.setItem('locale', l) } catch {} }
  return { locale: 'en', setLocale, t } as const
}
